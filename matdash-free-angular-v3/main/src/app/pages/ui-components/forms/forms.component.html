<mat-card class="p-4">
  <mat-card-header class="text-center mb-4">
    <mat-card-title class="w-100">Nuevo Trámite</mat-card-title>
    <mat-card-subtitle class="w-100">Ingrese su DNI y suba el documento</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="tramiteForm" (ngSubmit)="guardar()" class="row g-3">
      
      <!-- Campo DNI -->
      <div class="col-12">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>DNI</mat-label>
          <input matInput formControlName="dni" placeholder="Ingrese su DNI (8 dígitos)" maxlength="8">
          <mat-hint *ngIf="buscandoPersona" class="text-primary">Buscando persona...</mat-hint>
          <mat-hint *ngIf="personaEncontrada && !buscandoPersona" class="text-success">
            ✅ Persona encontrada: {{personaEncontrada.nombres}} {{personaEncontrada.apellidos}}
          </mat-hint>
          <mat-hint *ngIf="!personaEncontrada && dni?.valid && !buscandoPersona" class="text-warning">
            ℹ️ Persona no encontrada con este DNI
          </mat-hint>
          <mat-error *ngIf="dniInvalido">
            <span *ngIf="dni?.errors?.['required']">DNI es requerido</span>
            <span *ngIf="dni?.errors?.['pattern']">DNI debe tener 8 dígitos</span>
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Subida de archivo -->
      <div class="col-12">
        <div class="border rounded p-3 bg-light">
          <label class="form-label fw-bold mb-3">Documento PDF</label>
          <input type="file" accept=".pdf" (change)="onFileSelected($event)" class="form-control mb-2">
          <div class="text-muted">
            <small *ngIf="nombreArchivo" class="d-block">
              Archivo seleccionado: {{ nombreArchivo }}
            </small>
            <small class="d-block">
              Solo se permiten archivos PDF
            </small>
          </div>
        </div>
      </div>

      <!-- Botones -->
      <div class="col-12 mt-4">
        <div class="d-flex gap-2 justify-content-end border-top pt-3">
          <button mat-stroked-button type="button" (click)="cancelar()" [disabled]="guardando">
            Cancelar
          </button>
          <button mat-flat-button color="primary" type="submit" 
                  [disabled]="guardando || !personaEncontrada">
            {{ guardando ? 'Guardando...' : 'Iniciar Trámite' }}
          </button>
        </div>
      </div>

    </form>
  </mat-card-content>
</mat-card>